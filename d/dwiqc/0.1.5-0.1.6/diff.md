# Comparing `tmp/dwiqc-0.1.5-py2.py3-none-any.whl.zip` & `tmp/dwiqc-0.1.6-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,22 +1,22 @@
-Zip file size: 21780 bytes, number of entries: 20
--rw-r--r--  2.0 unx      225 b- defN 23-May-19 13:23 dwiqc/__init__.py
--rw-r--r--  2.0 unx      247 b- defN 23-May-19 14:20 dwiqc/__version__.py
--rw-r--r--  2.0 unx       62 b- defN 23-May-19 13:24 dwiqc/cli/__init__.py
--rw-r--r--  2.0 unx     6651 b- defN 23-May-15 18:24 dwiqc/cli/get.py
--rw-r--r--  2.0 unx     5273 b- defN 23-May-19 13:31 dwiqc/cli/process.py
--rw-r--r--  2.0 unx      160 b- defN 23-May-15 18:24 dwiqc/config/__init__.py
--rw-r--r--  2.0 unx      274 b- defN 23-May-15 18:24 dwiqc/config/dwiqc.yaml
--rw-r--r--  2.0 unx       98 b- defN 23-May-19 13:27 dwiqc/state/__init__.py
--rw-r--r--  2.0 unx     1892 b- defN 23-May-19 13:26 dwiqc/tasks/__init__.py
--rw-r--r--  2.0 unx     9470 b- defN 23-May-19 13:47 dwiqc/tasks/prequal.py
--rw-r--r--  2.0 unx     3697 b- defN 23-May-19 13:51 dwiqc/tasks/prequal_EQ.py
--rw-r--r--  2.0 unx     6193 b- defN 23-May-19 13:48 dwiqc/tasks/qsiprep.py
--rw-r--r--  2.0 unx     3782 b- defN 23-May-19 13:49 dwiqc/tasks/qsiprep_EQ.py
--rw-r--r--  2.0 unx    12888 b- defN 23-May-19 13:31 dwiqc/xnat/__init__.py
--rwxr-xr-x  2.0 unx     4016 b- defN 23-May-19 14:21 dwiqc-0.1.5.data/scripts/dwiQC.py
--rw-r--r--  2.0 unx     1541 b- defN 23-May-19 14:21 dwiqc-0.1.5.dist-info/LICENSE
--rw-r--r--  2.0 unx      388 b- defN 23-May-19 14:21 dwiqc-0.1.5.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-May-19 14:21 dwiqc-0.1.5.dist-info/WHEEL
--rw-r--r--  2.0 unx        6 b- defN 23-May-19 14:21 dwiqc-0.1.5.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     1559 b- defN 23-May-19 14:21 dwiqc-0.1.5.dist-info/RECORD
-20 files, 58532 bytes uncompressed, 19268 bytes compressed:  67.1%
+Zip file size: 22214 bytes, number of entries: 20
+-rw-r--r--  2.0 unx      225 b- defN 23-May-19 16:11 dwiqc/__init__.py
+-rw-r--r--  2.0 unx      247 b- defN 23-May-22 11:43 dwiqc/__version__.py
+-rw-r--r--  2.0 unx       62 b- defN 23-May-19 16:11 dwiqc/cli/__init__.py
+-rw-r--r--  2.0 unx     6651 b- defN 23-May-19 16:11 dwiqc/cli/get.py
+-rw-r--r--  2.0 unx     5273 b- defN 23-May-19 16:11 dwiqc/cli/process.py
+-rw-r--r--  2.0 unx      160 b- defN 23-May-19 16:11 dwiqc/config/__init__.py
+-rw-r--r--  2.0 unx      274 b- defN 23-May-19 16:11 dwiqc/config/dwiqc.yaml
+-rw-r--r--  2.0 unx       98 b- defN 23-May-19 16:11 dwiqc/state/__init__.py
+-rw-r--r--  2.0 unx     1892 b- defN 23-May-19 16:11 dwiqc/tasks/__init__.py
+-rw-r--r--  2.0 unx     9604 b- defN 23-May-22 11:40 dwiqc/tasks/prequal.py
+-rw-r--r--  2.0 unx     4209 b- defN 23-May-22 17:12 dwiqc/tasks/prequal_EQ.py
+-rw-r--r--  2.0 unx     6193 b- defN 23-May-19 16:11 dwiqc/tasks/qsiprep.py
+-rw-r--r--  2.0 unx     3782 b- defN 23-May-19 16:11 dwiqc/tasks/qsiprep_EQ.py
+-rw-r--r--  2.0 unx    13839 b- defN 23-May-19 16:11 dwiqc/xnat/__init__.py
+-rwxr-xr-x  2.0 unx     3876 b- defN 23-May-22 17:17 dwiqc-0.1.6.data/scripts/dwiQC.py
+-rw-r--r--  2.0 unx     1541 b- defN 23-May-22 17:17 dwiqc-0.1.6.dist-info/LICENSE
+-rw-r--r--  2.0 unx      432 b- defN 23-May-22 17:17 dwiqc-0.1.6.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-May-22 17:17 dwiqc-0.1.6.dist-info/WHEEL
+-rw-r--r--  2.0 unx        6 b- defN 23-May-22 17:17 dwiqc-0.1.6.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     1559 b- defN 23-May-22 17:17 dwiqc-0.1.6.dist-info/RECORD
+20 files, 60033 bytes uncompressed, 19702 bytes compressed:  67.2%
```

## zipnote {}

```diff
@@ -36,26 +36,26 @@
 
 Filename: dwiqc/tasks/qsiprep_EQ.py
 Comment: 
 
 Filename: dwiqc/xnat/__init__.py
 Comment: 
 
-Filename: dwiqc-0.1.5.data/scripts/dwiQC.py
+Filename: dwiqc-0.1.6.data/scripts/dwiQC.py
 Comment: 
 
-Filename: dwiqc-0.1.5.dist-info/LICENSE
+Filename: dwiqc-0.1.6.dist-info/LICENSE
 Comment: 
 
-Filename: dwiqc-0.1.5.dist-info/METADATA
+Filename: dwiqc-0.1.6.dist-info/METADATA
 Comment: 
 
-Filename: dwiqc-0.1.5.dist-info/WHEEL
+Filename: dwiqc-0.1.6.dist-info/WHEEL
 Comment: 
 
-Filename: dwiqc-0.1.5.dist-info/top_level.txt
+Filename: dwiqc-0.1.6.dist-info/top_level.txt
 Comment: 
 
-Filename: dwiqc-0.1.5.dist-info/RECORD
+Filename: dwiqc-0.1.6.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## dwiqc/__version__.py

```diff
@@ -1,6 +1,6 @@
 __title__ = 'dwiqc'
 __description__ = 'Quality Assurance Pipeline for Diffusion MR Data'
 __url__ = 'https://github.com/harvard-nrg/dwiqc'
-__version__ = '0.1.5'
+__version__ = '0.1.6'
 __author__ = 'Neuroinformatics Research Group'
 __author_email__ = 'info@neuroinfo.org'
```

## dwiqc/tasks/prequal.py

```diff
@@ -3,16 +3,17 @@
 
 import subprocess
 import os
 import logging
 from bids import BIDSLayout
 import sys
 import json
-import dwiqc
+#sys.path.insert(0, '/n/home_fasse/dasay/dwiqc/dwiqc/tasks')
 import dwiqc.tasks as tasks
+#import setup# as tasks
 import shutil
 from executors.models import Job
 
 
 logger = logging.getLogger(__name__)
 
 
@@ -295,14 +296,17 @@
 
 
 
 	# build the prequal sbatch command and create job
 
 	def build(self):
 		self.add_intended_for()
+		cwd = os.getcwd()
+		os.chdir(self._tempdir)
+		os.chdir(cwd)
 		inputs_dir = f'{self._tempdir}/INPUTS/'
 		self.copy_inputs(inputs_dir)
 		self._command = [
 			'selfie',
 			'--lock',
 			'--output-file', self._prov,
 			'singularity',
```

## dwiqc/tasks/prequal_EQ.py

```diff
@@ -1,102 +1,107 @@
-
 import shutil
 import os
 import time
 import sys
 sys.path.insert(0, os.path.join(os.environ['MODULESHOME'], "init"))
 from env_modules_python import module
 import dwiqc.tasks as tasks
 import logging
 import subprocess
 import json
 from executors.models import Job
 
 
-old_out = sys.stdout
-
-
 
 class Task(tasks.BaseTask):
 	def __init__(self, sub, ses, run, bids, outdir, parent=None, tempdir=None, pipenv=None):
 		self._sub = sub
 		self._ses = ses
 		self._run = run
 		self._bids = bids
 		super().__init__(outdir, tempdir, pipenv)
 
 
 	def build(self):
 
-		log_file = open("eddy_quad.log", "w")		
+		os.chdir(f"{self._outdir}/EDDY")
+
+		# define log file
+		logging.basicConfig(filename=f"{self._outdir}/logs/dwiqc-prequal.log", encoding='utf-8', level=logging.DEBUG)
+
+		logging.info('Loading FSL module: fsl/6.0.6.4-centos7_x64-ncf')
 
 		#load the fsl module
-		module('load','fsl/6.0.4-centos7_64-ncf')
-		#while not os.path.exists(f'{self._outdir}/EDDY'):
-		#	time.sleep(120)
-
-		if os.path.isdir(f'{self._outdir}/EDDY'):
-			os.chdir(f'{self._outdir}/EDDY')
-			log_file = open(f"{self._outdir}/EDDY/eddy_quad.log", "w")	
-			sys.stdout = log_file
+		module('load','fsl/6.0.6.4-centos7_x64-ncf')
 
-		# copy the necessary file to EDDY directory
+		logging.info('module succesfully loaded!')
 
-		#while not os.path.exists('../PREPROCESSED/dwmri.nii.gz'):
-		#	time.sleep(120)
+		# copy the necessary file to EDDY directory
 
-		if os.path.isfile('../PREPROCESSED/dwmri.nii.gz'):
-			shutil.copy('../PREPROCESSED/dwmri.nii.gz', 'eddy_results.nii.gz')
+		logging.info('copying dwmri.nii.gz file to EDDY dir')
+		if os.path.isfile(f'{self._outdir}/PREPROCESSED/dwmri.nii.gz'):
+			shutil.copy(f'{self._outdir}/PREPROCESSED/dwmri.nii.gz', f'{self._outdir}/EDDY/eddy_results.nii.gz')
 
 		else:
-			print("prequal failed... exiting.")
+			logging.error('PREPROCESSED/dwmri.nii.gz doesn\'t exist, which likely means prequal failed. exiting.')
 			sys.exit()
 
 		# grab name of slspec file
-
-		for file in os.listdir(self._outdir):
-			if 'slspec' in file and file.endswith('.txt'):
-				spec_file = file
+		logging.info(f'grabbing slspec file from {self._outdir}')
+		try:
+			for file in os.listdir(self._outdir):
+				if 'slspec' in file and file.endswith('.txt'):
+					spec_file = file
+		except FileNotFoundError:
+			logging.error('spec file not found. exiting.')
+			sys.exit()
 
 
 		eddy_quad = f"""singularity exec \
 		-B /n/home_fasse/dasay/eddy_quad_mofication/quad_mot.py:/APPS/fsl/fslpython/envs/fslpython/lib/python3.7/site-packages/eddy_qc/QUAD/quad_mot.py \
 		/n/sw/ncf/containers/masilab/prequal/1.0.8/prequal.sif \
 		/APPS/fsl/bin/eddy_quad \
 		eddy_results \
 		-idx index.txt \
 		-par acqparams.txt \
 		--mask=eddy_mask.nii.gz \
-		--bvals=../PREPROCESSED/dwmri.bval \
-		--bvecs=../PREPROCESSED/dwmri.bvec \
-		--field ../TOPUP/topup_field.nii.gz \
-		-s ../{spec_file} \
+		--bvals={self._outdir}/PREPROCESSED/dwmri.bval \
+		--bvecs={self._outdir}/PREPROCESSED/dwmri.bvec \
+		--field {self._outdir}/TOPUP/topup_field.nii.gz \
+		-s {self._outdir}/{spec_file} \
 		-v"""
 
-		try:
-			proc1 = subprocess.Popen(eddy_quad, shell=True, stdout=subprocess.PIPE)
-			proc1.communicate()
-		except ValueError:
-			print('Output directory already exists. Removing and trying again...')
-			os.rmdir("eddy_results.qc")
-			proc1 = subprocess.Popen(eddy_quad, shell=True, stdout=subprocess.PIPE)
-			proc1.communicate()
+
+		if os.path.isdir('eddy_results.qc'):
+			logging.warning('Output directory already exists. Removing and trying again.')
+			shutil.rmtree('eddy_results.qc')
+
+
+		logging.info('Running eddy_quad...')
+		proc1 = subprocess.Popen(eddy_quad, shell=True, stdout=subprocess.PIPE)
+		proc1.communicate()
+		code = proc1.returncode
+
+		if code == 0:
+			logging.info('eddy quad ran without errors!')
+		else:
+			logging.error('eddy quad threw an error. exiting.')
+			sys.exit()
 
 		eddy_results_dir = f'{self._outdir}/EDDY/eddy_results.qc'
 
 		self.parse_json(eddy_results_dir)
 
-		log_file.close()
-
 
 	def parse_json(self, eddy_dir):
+		logging.info('parsing qc.json file.')
 		with open(f'{eddy_dir}/qc.json', 'r') as file:
 			data = json.load(file)
 
-				## grab the needed metrics
+		## grab the needed metrics
 
 		#	****** Volume to Volume Motion ******
 
 			metrics_dict = {}
 
 			# average absolute motion
 
@@ -145,7 +150,8 @@
 
 		## Write out all these values to json file
 
 
 		with open('eddy_metrics.json', 'w') as outfile:
 			json.dump(metrics_dict, outfile, indent=1)
 
+		logging.info('successfully parsed json and wrote out results to eddy_metrics.json')
```

## dwiqc/xnat/__init__.py

```diff
@@ -7,14 +7,15 @@
 import json
 import lxml
 import shutil
 import zipfile
 import logging
 import numpy as np
 from lxml import etree
+from anatqc.bids import BIDS
 from bids import BIDSLayout
 
 logger = logging.getLogger(__name__)
 
 EDDY_METRICS = [
     'Average_SNR_b0', 'Average_CNR_b500','Average_CNR_b1000', 'Average_CNR_b2000', 
     'Average_CNR_b3000', 'Average_abs_motion_mm', 'Average_rel_motion_mm', 'Average_x_translation_mm',
@@ -74,16 +75,22 @@
             'xs': 'http://www.w3.org/2001/XMLSchema',
             'xsi': 'http://www.w3.org/2001/XMLSchema-instance',
             'xnat': 'http://nrg.wustl.edu/xnat',
             'neuroinfo': 'http://www.neuroinfo.org/neuroinfo'
         }
         # read dwi json sidecar for scan number
         dwi_file = self.layout.get(subject=self.sub, session=self.ses, suffix='dwi', extension='.nii.gz').pop()
+        PA_file = self.layout.get(subject=self.sub, session=self.ses, suffix='epi', extension='.nii.gz', direction='PA').pop()
+        AP_file = self.layout.get(subject=self.sub, session=self.ses, suffix='epi', extension='.nii.gz', direction='AP').pop()
         DWI_ds = dwi_file.get_metadata()['DataSource']['application/x-xnat']
+        PA_ds = PA_file.get_metadata()['DataSource']['application/x-xnat']
+        AP_ds = AP_file.get_metadata()['DataSource']['application/x-xnat']
         logger.info('DWI info %s', '|'.join(DWI_ds))
+        logger.info('FMAP PA info %s', '|'.join(PA_ds))
+        logger.info('FMAP AP info %s', '|'.join(AP_ds))
         # assessment id
         aid = '{0}_DWI_{1}_AQC'.format(DWI_ds['experiment'], DWI_ds['scan'])
         logger.info('Assessor ID %s', aid)
         # root element
         xnatns = '{%s}' % ns['xnat']
         root = etree.Element('DWIQC', nsmap=ns)
         root.attrib['project'] = DWI_ds['project']
@@ -174,15 +181,19 @@
                 'source': os.path.join(self.dirs['qsiprep'], 'qsiprep_output', 'qsiprep',  self.sub, 'figures', self.sub + '_t1_2_mni.svg'),
                 'dest': os.path.join('t1-registration', '{0}_t1_registration.svg'.format(aid))
             }
         ]
         # start building XML
         xnatns = '{%s}' % ns['xnat']
         etree.SubElement(root, xnatns + 'imageSession_ID').text = DWI_ds['experiment_id']
+        etree.SubElement(root, 'PA_fmap_scan_id').text = PA_ds['scan']
+        etree.SubElement(root, 'AP_fmap_scan_id').text = AP_ds['scan']
         etree.SubElement(root, 'dwi_scan_id').text = DWI_ds['scan']
+        etree.SubElement(root, 'session_label').text = DWI_ds['experiment']
+
         # add <eddy_quad> element
         eddy_quad_elm = etree.SubElement(root, 'eddy_quad')
         fname = os.path.join(
             self.dirs['prequal'],
             'OUTPUTS',
             'EDDY',
             'eddy_results.qc',
@@ -283,7 +294,14 @@
         no_extension = os.path.splitext(basename)[0]
 
         return no_extension
 
 
 class AssessmentError(Exception):
     pass
+
+
+#instance = Report('/n/home_fasse/dasay/mockup_dwiqc_output', 'PE161458', 'PE161458220526', '1')
+
+#instance.build_assessment('/n/home_fasse/dasay/mockup_dwiqc_output/xnat-artifacts')
+
+
```

## Comparing `dwiqc-0.1.5.data/scripts/dwiQC.py` & `dwiqc-0.1.6.data/scripts/dwiQC.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,31 +1,24 @@
 #!python
-
-
-
-
 import sys
-#sys.path.insert(0, '/n/home_fasse/dasay/dwiqc/dwiqc/cli')
-#sys.path.insert(0, '/n/home_fasse/dasay/dwiqc/dwiqc/config')
-import dwiqc
 import dwiqc.cli as cli
 import logging
 import argparse as ap
-#import dwiqc.config as config
+import dwiqc.config as config
 
 logger = logging.getLogger(__name__)
 
 
 
 
 def main():
     parser = ap.ArgumentParser()
     parser.add_argument('-v', '--verbose', action='store_true',
         help='Enable verbose logging')
-    parser.add_argument('-c', '--config', #default=config.default(),
+    parser.add_argument('-c', '--config', default=config.default(),
         help='dwiQC configuration file')
     parser.add_argument('--insecure', action='store_true',
         help='Disable SSL certificate verification')
     subparsers = parser.add_subparsers(help='sub-command help')
     # get mode
     parser_get = subparsers.add_parser('get', help='get -h')
     parser_get.add_argument('--label', required=True,
```

## Comparing `dwiqc-0.1.5.dist-info/LICENSE` & `dwiqc-0.1.6.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `dwiqc-0.1.5.dist-info/RECORD` & `dwiqc-0.1.6.dist-info/RECORD`

 * *Files 13% similar despite different names*

```diff
@@ -1,20 +1,20 @@
 dwiqc/__init__.py,sha256=MZJhUZKhHHoZ2w_GeoFCITk1m_0ASdRw_ZaeDixFEPU,225
-dwiqc/__version__.py,sha256=YUc8aPHVKYcL0bNu62DvwwXlBDIy2t13wD1eV0X2_H0,247
+dwiqc/__version__.py,sha256=50io5Tx6T9X_YO_hb6xtNGd0H7R7JVEU_sGpfCbMeWY,247
 dwiqc/cli/__init__.py,sha256=zGIm7lrjh3wA191D-VjQBZNjSlspFUx148VwDNQGaTk,62
 dwiqc/cli/get.py,sha256=6ixaBdwEgY_GXh8L-_3QDY4MEsNqSJgXle_mxW99mlk,6651
 dwiqc/cli/process.py,sha256=X4eUXf-jRuOR_3cVQ0FfcDXmNPVQzILH35uGAtz9upE,5273
 dwiqc/config/__init__.py,sha256=k_w5JzoJN_7R7eI_sIJxHA4FQQHs0_KGf-6jsbG4Xs8,160
 dwiqc/config/dwiqc.yaml,sha256=x8gKMFZyChdzvNX3GthRe0eWvyKDDL5itXo0kLWVfd0,274
 dwiqc/state/__init__.py,sha256=NaRifw26bI3F1J9BqeLa-KLSzEPq2m_UNhMbXdmPdh4,98
 dwiqc/tasks/__init__.py,sha256=LnlN7iYjpqiBic2ihFrM-_h7m8FD_N7Beh7UIwKyGZ8,1892
-dwiqc/tasks/prequal.py,sha256=w3vpr53Qrs75Ke6MZTw_jlfMZ6aHWoyFM6yWnC9Bqtg,9470
-dwiqc/tasks/prequal_EQ.py,sha256=LZOrTSqjVz2Zr7p0FUdkCUUFxjE3pjpi1TayZktbIek,3697
+dwiqc/tasks/prequal.py,sha256=5Bgf8D_ML0hXZlV-5s2j8tHiWqUMAQc9XuvV22LIkb4,9604
+dwiqc/tasks/prequal_EQ.py,sha256=PWmlo8u_D5qM1lyXdmT7iq865JL6xoPM0JHGEwzRnes,4209
 dwiqc/tasks/qsiprep.py,sha256=RS8M07BO7ngImbUl1uaOSwPu1BF3NOB_-NhVcuP8vVc,6193
 dwiqc/tasks/qsiprep_EQ.py,sha256=JWildptHsuyJVj7ZYMFlWWYvsAIszJpWk1a0m05JM-Q,3782
-dwiqc/xnat/__init__.py,sha256=Hp0cHw98fDnOmG6sWJ1HI_DFck0h6fiV5VshQa_HTYI,12888
-dwiqc-0.1.5.data/scripts/dwiQC.py,sha256=Z-Xt04-T9n4ZixWY_1O4gL3Oc7Em0ewwfLcktOlTsUw,4016
-dwiqc-0.1.5.dist-info/LICENSE,sha256=ReOF9BmlQdkCj4b2gQYogJrk_QkbUAuz8W1ZVqI0pcs,1541
-dwiqc-0.1.5.dist-info/METADATA,sha256=lmSvO-R4V_yHqsa__-5G7fBxJPzloA8LboUhemhqEJ8,388
-dwiqc-0.1.5.dist-info/WHEEL,sha256=bb2Ot9scclHKMOLDEHY6B2sicWOgugjFKaJsT7vwMQo,110
-dwiqc-0.1.5.dist-info/top_level.txt,sha256=omH7pmKt7fzFyiNkTPDLX4yyBccoge5Saqc9rgyu0Wk,6
-dwiqc-0.1.5.dist-info/RECORD,,
+dwiqc/xnat/__init__.py,sha256=PyJJtcfxf71c9x1LwdCem2bT_2MNuqhRmb0uLTfoGgs,13839
+dwiqc-0.1.6.data/scripts/dwiQC.py,sha256=PCkcQfG5Xpm83O_Da4nw_dAozAtN83d1rF5lmoUUyQg,3876
+dwiqc-0.1.6.dist-info/LICENSE,sha256=ReOF9BmlQdkCj4b2gQYogJrk_QkbUAuz8W1ZVqI0pcs,1541
+dwiqc-0.1.6.dist-info/METADATA,sha256=BrzjpugLoUJeSb_LCpI6qwXmXRxrE1IcDIXDAVDSrcg,432
+dwiqc-0.1.6.dist-info/WHEEL,sha256=z9j0xAa_JmUKMpmz72K0ZGALSM_n-wQVmGbleXx2VHg,110
+dwiqc-0.1.6.dist-info/top_level.txt,sha256=omH7pmKt7fzFyiNkTPDLX4yyBccoge5Saqc9rgyu0Wk,6
+dwiqc-0.1.6.dist-info/RECORD,,
```

